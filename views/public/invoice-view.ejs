<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Invoice <%= invoice.invoiceNumber %></title>
  <link rel="stylesheet" href="/css/invoice.css">
</head>

<body>
<div class="invoice-page">

  <!-- HEADER -->
  <div class="invoice-header">
    <div class="logo">
      <% include ../partials/paw-logo %>
      <div class="brand-text">
        <strong>ImperialPaws</strong>
        <span>PEKINGESE</span>
      </div>
    </div>

    <div class="invoice-meta">
      <h1>INVOICE</h1>
      <% if (invoice.invoiceNumber) { %>
        <p><strong>Invoice No:</strong> <%= invoice.invoiceNumber %></p>
      <% } %>
      <% if (invoice.createdAt) { %>
        <p><strong>Date:</strong>
          <%= new Date(invoice.createdAt).toLocaleDateString() %>
        </p>
      <% } %>
    </div>
  </div>

  <!-- BILL TO -->
  <% if (invoice.adoptingParent) { %>
  <div class="card">
    <h3>ADOPTING PARENT</h3>
    <p><strong><%= invoice.adoptingParent.name %></strong></p>
    <% if (invoice.adoptingParent.email) { %>
      <p><%= invoice.adoptingParent.email %></p>
    <% } %>
  </div>
  <% } %>

  <!-- ITEMS -->
  <% if (invoice.items && invoice.items.length) { %>
  <table class="items">
    <thead>
      <tr>
        <th>Description</th>
        <th>Qty</th>
        <th>Unit</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody>
      <% let subtotal = 0; %>
      <% invoice.items.forEach(item => {
           const line = Number(item.qty) * Number(item.unitPrice);
           subtotal += line;
      %>
      <tr>
        <td><%= item.description %></td>
        <td><%= item.qty %></td>
        <td><%= invoice.currency %><%= Number(item.unitPrice).toFixed(2) %></td>
        <td><%= invoice.currency %><%= line.toFixed(2) %></td>
      </tr>
      <% }) %>
    </tbody>
  </table>
  <% } %>

  <!-- TOTAL -->
  <div class="totals">
    <p>
      Subtotal
      <span><%= invoice.currency %><%= subtotal.toFixed(2) %></span>
    </p>

    <% if (invoice.taxRate) { %>
      <p>
        Tax (<%= invoice.taxRate * 100 %>%)
        <span>
          <%= invoice.currency %><%= (subtotal * invoice.taxRate).toFixed(2) %>
        </span>
      </p>
    <% } %>

    <p class="grand">
      Total
      <span>
        <%= invoice.currency %>
        <%= (subtotal + (invoice.taxRate ? subtotal * invoice.taxRate : 0)).toFixed(2) %>
      </span>
    </p>
  </div>

  <!-- PRINT -->
  <div class="invoice-actions no-print">
    <button onclick="window.print()" class="btn-primary">
      Download / Print PDF
    </button>
  </div>

</div>
</body>
</html>
